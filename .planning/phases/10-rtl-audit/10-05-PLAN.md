---
phase: 10-rtl-audit
plan: 05
type: execute
wave: 3
depends_on: ["10-02", "10-03", "10-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All pages audited in Arabic locale with zero layout breaks or visual regressions"
    - "Progress bars fill right-to-left in Arabic mode"
    - "Numbers and dates formatted with proper locale-aware formatting in both languages"
    - "All translation keys present with no missing keys or raw fallback text visible"
    - "Both client and coach flows work identically well in English and Arabic"
  artifacts: []
  key_links: []
---

<objective>
Verify all RTL changes work correctly across the entire application by running automated checks and presenting results for human visual verification.

Purpose: RTL changes are subtle and can introduce layout breaks that only manifest visually. This plan runs automated validation (TypeScript, grep sweeps, translation audit) and then presents the app for human verification in Arabic mode.

Output: Confirmed working RTL experience across all user flows.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-rtl-audit/10-01-SUMMARY.md
@.planning/phases/10-rtl-audit/10-02-SUMMARY.md
@.planning/phases/10-rtl-audit/10-03-SUMMARY.md
@.planning/phases/10-rtl-audit/10-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Automated RTL audit sweep</name>
  <files></files>
  <action>
    Run a comprehensive automated audit to catch remaining issues:

    1. **TypeScript check:**
       ```bash
       pnpm tsc --noEmit
       ```

    2. **Physical property sweep across entire src/:**
       ```bash
       # Check for remaining physical directional properties in app code
       # Exclude: node_modules, .next, animation classes (slide-in-from-*), inset-y-0 (vertical)
       grep -rn --include="*.tsx" --include="*.ts" \
         -e '\bml-' -e '\bmr-' -e '\bpl-' -e '\bpr-' -e '\bborder-l-' -e '\bborder-r-' \
         -e '\bleft-[0-9]' -e '\bright-[0-9]' -e '\btext-left\b' -e '\btext-right\b' \
         src/app/ src/components/ \
         | grep -v 'slide-in-from' \
         | grep -v 'inset-y-0' \
         | grep -v 'node_modules' \
         | grep -v '.next'
       ```
       Document any remaining findings. Some may be intentional (e.g., `left-0 right-0` for full-width overlays, `px-` which is not directional).

    3. **Hardcoded locale sweep:**
       ```bash
       grep -rn '"en-US"\|"en-us"\|"ar-EG"' src/app/ src/components/ src/lib/
       ```
       Should only find the utility functions in `src/lib/utils/index.ts` (which now use `ar-u-nu-latn`). Zero matches expected.

    4. **Bare toLocaleDateString sweep:**
       ```bash
       grep -rn '\.toLocaleDateString()' src/app/ src/components/
       ```
       Zero matches expected (all should have locale parameter).

    5. **Directional icon sweep:**
       ```bash
       # Find ArrowRight/ArrowLeft/ChevronRight usage without rtl:rotate-180
       grep -rn 'ArrowRight\|ArrowLeft\|ChevronRight' src/app/ src/components/ \
         | grep -v 'import' \
         | grep -v 'from' \
         | grep -v 'rtl:rotate-180' \
         | grep -v 'ChevronDown'
       ```
       Should return zero results (all directional icons have rtl:rotate-180).

    6. **Translation key parity check:**
       Run a quick Node.js script to verify en.json and ar.json have identical key structures:
       ```bash
       node -e "
       const en = require('./src/messages/en.json');
       const ar = require('./src/messages/ar.json');
       function getKeys(obj, prefix='') {
         let keys = [];
         for (const key of Object.keys(obj)) {
           const fullKey = prefix ? prefix + '.' + key : key;
           if (typeof obj[key] === 'object' && obj[key] !== null) {
             keys = keys.concat(getKeys(obj[key], fullKey));
           } else { keys.push(fullKey); }
         }
         return keys;
       }
       const enKeys = getKeys(en);
       const arKeys = getKeys(ar);
       const missingInAr = enKeys.filter(k => !arKeys.includes(k));
       const missingInEn = arKeys.filter(k => !enKeys.includes(k));
       console.log('EN keys:', enKeys.length, '| AR keys:', arKeys.length);
       console.log('Missing in AR:', missingInAr.length, missingInAr);
       console.log('Missing in EN:', missingInEn.length, missingInEn);
       if (missingInAr.length === 0 && missingInEn.length === 0) {
         console.log('PASS: All translation keys in sync');
       } else {
         console.log('FAIL: Translation key mismatch');
       }
       "
       ```

    7. **Build check:**
       ```bash
       pnpm build
       ```
       Confirm the full build succeeds with all RTL changes.

    Report all findings. Fix any issues found (minor physical property misses, etc.) before proceeding to human verification.
  </action>
  <verify>
    All 7 automated checks pass. `pnpm build` succeeds. No remaining physical directional properties in app code (excluding intentional cases documented). Translation keys in perfect sync.
  </verify>
  <done>
    Automated RTL audit confirms: zero physical directional properties remaining, zero hardcoded locales, zero bare date formatting, all directional icons flip, translation keys in sync, build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual RTL verification across all user flows</name>
  <action>
    Present the application for human visual verification in both Arabic and English modes. The automated audit (Task 1) has confirmed code-level correctness; this checkpoint verifies the visual result.
  </action>
  <what-built>
    Complete RTL/Arabic audit across all user flows:
    - All shadcn/ui components converted to logical CSS properties
    - All date/number formatting is locale-aware (Arabic dates in Arabic mode)
    - Progress bars fill right-to-left in Arabic
    - Time-series charts stay left-to-right (universal)
    - All directional icons (arrows, chevrons) flip in RTL
    - All auth, onboarding, dashboard, and admin pages use logical properties
    - Translation keys verified in sync (490/490)
  </what-built>
  <how-to-verify>
    Start the dev server: `pnpm dev`

    **Test in Arabic mode** (switch locale to Arabic or visit http://localhost:3000/ar):

    1. **Auth flow:**
       - Visit /ar/login - Check input icon positions (should be on right side in RTL)
       - Visit /ar/magic-link - Check back arrow points right, input icon on right
       - Visit /ar/set-password - Check both password fields have icons on right

    2. **Onboarding flow:**
       - Visit /ar/welcome - Check arrow icon points left (RTL forward direction)
       - Visit /ar/initial-assessment - Check gender buttons have correct border sides, dropdown chevron on left side

    3. **Dashboard pages:**
       - Visit /ar/dashboard - Check date displays in Arabic format
       - Visit /ar/tickets - Check dates are Arabic-formatted, chevron arrows point correctly
       - Visit /ar/progress - Check dates in Arabic, progress bars fill from right
       - Visit /ar/tracking - Check circular progress, date picker
       - Visit /ar/check-in - Check step navigation arrows flip correctly
       - Visit /ar/settings - Check date format is Arabic

    4. **Admin pages:**
       - Visit /ar/admin/login - Check input icons on correct side
       - Visit /ar/admin (panel) - Check arrow icons flip, dates are Arabic-formatted
       - Visit /ar/admin/clients - Check client list arrows, dates

    5. **Verify NO broken layouts:**
       - No overlapping elements
       - No elements cut off or overflowing
       - No text alignment issues
       - Tab borders on correct sides
       - Dialog close buttons in correct corners
       - Dropdown menus appear in correct positions

    6. **Compare English mode** (visit /en equivalents) to ensure nothing broke in LTR.
  </how-to-verify>
  <verify>Human confirms all pages render correctly in both Arabic and English modes.</verify>
  <done>Human approves the RTL visual audit with no layout breaks or visual regressions.</done>
  <resume-signal>Type "approved" if all pages look correct in both Arabic and English, or describe any visual issues found.</resume-signal>
</task>

</tasks>

<verification>
- `pnpm tsc --noEmit` passes
- `pnpm build` succeeds
- All automated grep sweeps pass
- Translation keys in sync (490/490)
- Human verification confirms visual correctness in both Arabic and English
</verification>

<success_criteria>
Phase 10 success criteria met:
1. All pages audited in Arabic locale with zero layout breaks or visual regressions
2. Progress bars and directional UI elements respect RTL (fill right-to-left in Arabic)
3. Numbers and dates formatted with proper locale-aware formatting in both languages
4. All translation keys present with no missing keys or raw fallback text visible
5. Both client and coach flows work identically well in English and Arabic
</success_criteria>

<output>
After completion, create `.planning/phases/10-rtl-audit/10-05-SUMMARY.md`
</output>
