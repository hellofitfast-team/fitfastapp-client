---
phase: 11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey
plan: 07
type: execute
wave: 4
depends_on: ["11.1-04", "11.1-05", "11.1-06"]
files_modified: []
autonomous: false
requirements:
  - END-TO-END-FLOW

must_haves:
  truths:
    - "Full acquisition circle works: marketing site -> checkout -> invitation email -> accept invite -> pending -> approval -> initial assessment"
    - "Admin can configure plans and payment methods that appear on marketing site"
    - "Admin can approve/reject signups with proper Clerk integration"
    - "Both English and Arabic layouts work correctly across all three apps"
  artifacts: []
  key_links: []
---

<objective>
Verify the end-to-end client acquisition flow works across all three apps (marketing, client, admin).

Purpose: This phase involves complex cross-app integration. A human verification ensures everything connects properly before marking the phase complete.
Output: Confirmed working flow or list of issues to fix.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey/11.1-01-SUMMARY.md
@.planning/phases/11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey/11.1-05-SUMMARY.md
@.planning/phases/11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey/11.1-06-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: End-to-end flow verification</name>
  <what-built>
Complete client acquisition circle across 3 apps:
- Marketing site (port 3002): Landing page with Hero, Features, Pricing, Trust signals, and Checkout drawer
- Client PWA (port 3000): Accept-invite page, Pending approval page with real-time auto-redirect
- Admin panel (port 3001): Signup list/detail with payment screenshot, approve/reject with reason, plans & payment methods config
  </what-built>
  <how-to-verify>
**Pre-requisites:**
1. Start all 3 apps: `pnpm dev`
2. Ensure Convex dev server is running: `npx convex dev`
3. Set env vars in Convex: `CLERK_SECRET_KEY`, `CLIENT_APP_URL=http://localhost:3000`

**Test 1 — Admin configures plans and payment methods:**
1. Go to `http://localhost:3001/en/settings`
2. Add a pricing plan (e.g., "Starter", 1500 EGP, 3 months, with features)
3. Add a payment method (e.g., "InstaPay", account details)
4. Save both
5. Go to `http://localhost:3002` (marketing) — verify plan appears in pricing section
6. Expected: Plan card shows with correct details; payment instructions appear in checkout

**Test 2 — Prospect submits checkout:**
1. On marketing page, click "Choose Plan" on a pricing card
2. Checkout drawer opens with form
3. Fill in name, email, phone, upload a screenshot image
4. Verify payment instructions show the methods configured in Test 1
5. Submit the form
6. Expected: Redirects to confirmation page with "Check your email" message

**Test 3 — Admin approves signup:**
1. Go to admin signups page: `http://localhost:3001/en/signups`
2. New signup should appear in the list
3. Click "View Details" — verify payment screenshot is visible
4. Click "Approve"
5. Expected: Clerk invitation email is sent to the prospect's email address

**Test 4 — Prospect accepts invitation (if email received):**
1. Click the invitation link in email
2. Should land on `http://localhost:3000/en/accept-invite?__clerk_ticket=...`
3. Set password, submit
4. Expected: Redirects to pending approval page

**Test 5 — Admin RBAC:**
1. Try accessing admin panel with a non-coach Clerk user
2. Expected: Redirected to login page with `?error=not_coach`

**Test 6 — Arabic/RTL:**
1. Switch marketing page to Arabic — verify RTL layout for all sections
2. Switch admin to Arabic — verify settings and signups pages work
3. Switch client to Arabic — verify accept-invite and pending pages work

**Test 7 — Rejection flow (optional):**
1. Submit another checkout form with a different email
2. In admin, click "Reject" on the new signup
3. Enter a rejection reason
4. Expected: Signup status changes to rejected, rejection email sent
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues encountered</resume-signal>
</task>

</tasks>

<verification>
All 7 test scenarios pass without errors.
</verification>

<success_criteria>
- The full client acquisition circle works end-to-end
- Coach can manage pricing and payment methods from admin
- Clerk invitation flow creates accounts on approval
- Arabic/RTL works across all three apps
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey/11.1-07-SUMMARY.md`
</output>
