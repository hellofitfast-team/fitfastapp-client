---
phase: 11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/marketing/package.json
  - apps/marketing/next.config.ts
  - apps/marketing/tsconfig.json
  - apps/marketing/postcss.config.mjs
  - apps/marketing/middleware.ts
  - apps/marketing/src/app/layout.tsx
  - apps/marketing/src/app/globals.css
  - apps/marketing/src/app/[locale]/layout.tsx
  - apps/marketing/src/app/[locale]/page.tsx
  - apps/marketing/src/i18n/request.ts
  - apps/marketing/src/i18n/routing.ts
  - apps/marketing/src/messages/en.json
  - apps/marketing/src/messages/ar.json
  - apps/marketing/src/components/providers/convex-provider.tsx
  - package.json
autonomous: true
requirements:
  - MARKETING-SCAFFOLD
  - MARKETING-BILINGUAL

must_haves:
  truths:
    - "Marketing app starts on port 3002 via pnpm dev:marketing"
    - "Marketing app renders a page at / with locale detection (en/ar)"
    - "Language switcher toggles between English and Arabic with RTL layout"
    - "Marketing app uses same design tokens as client app (royal blue theme)"
  artifacts:
    - path: "apps/marketing/package.json"
      provides: "Marketing app package configuration"
      contains: "@fitfast/marketing"
    - path: "apps/marketing/src/app/[locale]/layout.tsx"
      provides: "Locale layout with NextIntlClientProvider and ConvexClientProvider"
    - path: "apps/marketing/middleware.ts"
      provides: "next-intl only middleware (no Clerk)"
  key_links:
    - from: "apps/marketing/src/app/[locale]/layout.tsx"
      to: "@fitfast/ui"
      via: "transpilePackages in next.config.ts"
      pattern: "transpilePackages"
    - from: "apps/marketing/middleware.ts"
      to: "apps/marketing/src/i18n/routing.ts"
      via: "createMiddleware(routing)"
      pattern: "createMiddleware"
---

<objective>
Scaffold the `apps/marketing/` Next.js app as a 3rd monorepo member with i18n (EN + AR RTL), Convex provider (for pricing data), and shared design tokens. No Clerk — this app is fully public.

Purpose: The marketing app is the entry point for prospects. It must be fully functional as a standalone Next.js app before landing page content and checkout are added.
Output: A running Next.js app at port 3002 with locale routing, Convex connection, and the same royal blue design language as the client app.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey/11.1-RESEARCH.md
@apps/client/package.json
@apps/client/next.config.ts
@apps/client/tsconfig.json
@apps/client/middleware.ts
@apps/client/src/app/layout.tsx
@apps/client/src/app/globals.css
@apps/client/src/app/[locale]/layout.tsx
@apps/client/src/i18n/request.ts
@packages/i18n/src/routing.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create marketing app package and configuration files</name>
  <files>
    apps/marketing/package.json
    apps/marketing/next.config.ts
    apps/marketing/tsconfig.json
    apps/marketing/postcss.config.mjs
    apps/marketing/middleware.ts
    apps/marketing/src/i18n/request.ts
    apps/marketing/src/i18n/routing.ts
    package.json
  </files>
  <action>
**Create `apps/marketing/package.json`:**
```json
{
  "name": "@fitfast/marketing",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack --port 3002",
    "build": "next build",
    "start": "next start --port 3002",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  }
}
```
Then run: `pnpm --filter @fitfast/marketing add next@latest react@latest react-dom@latest next-intl convex lucide-react tailwind-merge clsx`
And devDeps: `pnpm --filter @fitfast/marketing add -D typescript @types/react @types/react-dom tailwindcss @tailwindcss/postcss`

**Create `apps/marketing/next.config.ts`:**
- Copy pattern from `apps/client/next.config.ts`
- Must include `transpilePackages: ["@fitfast/ui", "@fitfast/i18n"]`
- Must include next-intl plugin: `createNextIntlPlugin("./src/i18n/request.ts")`
- Remove any Sentry or PWA plugins

**Create `apps/marketing/tsconfig.json`:**
- Extend from `@fitfast/config/tsconfig.base.json` if it exists, otherwise base Next.js config
- Add path alias: `"@/*": ["./src/*"]`
- Add convex path alias: `"@/convex/*": ["../../convex/*"]` (same as client/admin)

**Create `apps/marketing/postcss.config.mjs`:**
- Same as client app: `export default { plugins: { "@tailwindcss/postcss": {} } }`

**Create `apps/marketing/middleware.ts`:**
- next-intl middleware ONLY (no Clerk). Pattern:
```typescript
import createMiddleware from "next-intl/middleware";
import { routing } from "./src/i18n/routing";
export default createMiddleware(routing);
export const config = { matcher: ["/((?!api|_next|_vercel|.*\\..*).*)"] };
```

**Create `apps/marketing/src/i18n/request.ts` and `routing.ts`:**
- Copy patterns from client app's i18n setup
- `routing.ts`: `import { defineRouting } from "next-intl/routing"; export const routing = defineRouting({ locales: ["en", "ar"], defaultLocale: "en" });`
- `request.ts`: `import { getRequestConfig } from "next-intl/server"; import { routing } from "./routing"; export default getRequestConfig(async ({ requestLocale }) => { let locale = await requestLocale; if (!locale || !routing.locales.includes(locale as any)) { locale = routing.defaultLocale; } return { locale, messages: (await import(\`../messages/\${locale}.json\`)).default }; });`

**Update root `package.json`:**
- Add script: `"dev:marketing": "turbo dev --filter=@fitfast/marketing"`
- Update `"dev"` script to include marketing: `"turbo dev"` (turbo already picks up all workspace apps, but ensure it works)
  </action>
  <verify>Run `pnpm install` from root. Verify `apps/marketing/node_modules` exists. Run `pnpm --filter @fitfast/marketing type-check` — may fail since app files don't exist yet but config should be valid.</verify>
  <done>Marketing app package is configured with all dependencies, Next.js config with transpilePackages, TypeScript config with Convex path alias, PostCSS for Tailwind v4, and i18n routing (next-intl only, no Clerk).</done>
</task>

<task type="auto">
  <name>Task 2: Create marketing app layouts, globals, Convex provider, and placeholder page</name>
  <files>
    apps/marketing/src/app/layout.tsx
    apps/marketing/src/app/globals.css
    apps/marketing/src/app/[locale]/layout.tsx
    apps/marketing/src/app/[locale]/page.tsx
    apps/marketing/src/components/providers/convex-provider.tsx
    apps/marketing/src/messages/en.json
    apps/marketing/src/messages/ar.json
  </files>
  <action>
**Create `apps/marketing/src/app/globals.css`:**
- Copy the design tokens and Tailwind setup from `apps/client/src/app/globals.css`
- Keep the same royal blue theme, colors, font variables, spacing
- Include `@import "tailwindcss";` and the `@theme` block
- Do NOT include any Clerk `@layer` declarations (no Clerk in marketing)

**Create `apps/marketing/src/app/layout.tsx`:**
- Root layout (server component)
- Import globals.css
- Set `<html lang={locale} dir={locale === "ar" ? "rtl" : "ltr"} suppressHydrationWarning>`
- Minimal: just html, body, children
- Add Inter font from next/font/google (same as client app)

**Create `apps/marketing/src/components/providers/convex-provider.tsx`:**
- "use client" component
- ConvexProvider wrapping children with `ConvexReactClient` (NO ConvexProviderWithClerk — marketing is unauthenticated)
- Use `process.env.NEXT_PUBLIC_CONVEX_URL!` for the Convex URL
- Pattern: `const convex = new ConvexReactClient(process.env.NEXT_PUBLIC_CONVEX_URL!);`

**Create `apps/marketing/src/app/[locale]/layout.tsx`:**
- Server component that:
  1. Receives `params.locale`
  2. Loads messages via `getMessages()` from `next-intl/server`
  3. Wraps children in `<NextIntlClientProvider messages={messages}>`
  4. Wraps in `<ConvexProvider>` (the custom provider above)
  5. Sets `<html dir>` and `lang` based on locale

**Create `apps/marketing/src/app/[locale]/page.tsx`:**
- Placeholder landing page with "FitFast — Coming Soon" heading
- Use `useTranslations("landing")` for any text
- Import `Button` from `@fitfast/ui/button` to verify the shared package works
- Render a simple centered layout with the royal blue primary color

**Create `apps/marketing/src/messages/en.json` and `ar.json`:**
- Minimal structure with `"landing"` namespace
- en: `{ "landing": { "title": "FitFast", "subtitle": "AI-Powered Fitness Coaching", "comingSoon": "Coming Soon" } }`
- ar: `{ "landing": { "title": "فيت فاست", "subtitle": "تدريب لياقة بدنية بالذكاء الاصطناعي", "comingSoon": "قريباً" } }`
  </action>
  <verify>Run `pnpm dev:marketing` and verify the app starts on port 3002. Navigate to `http://localhost:3002` — should redirect to `/en`. Navigate to `/ar` — should show Arabic text with RTL layout. Verify `@fitfast/ui` Button component renders correctly.</verify>
  <done>Marketing app runs on port 3002 with locale routing (en/ar), RTL support, Convex provider (unauthenticated), and same design tokens as client app. Shared UI package imports work.</done>
</task>

</tasks>

<verification>
1. `pnpm dev:marketing` starts without errors on port 3002
2. `http://localhost:3002` redirects to `/en` and renders placeholder page
3. `http://localhost:3002/ar` renders Arabic RTL layout
4. `@fitfast/ui` Button component renders correctly on the page
5. `pnpm build --filter=@fitfast/marketing` succeeds
</verification>

<success_criteria>
- Marketing app is a fully functional 3rd monorepo member
- Shares design tokens, UI components, and i18n infrastructure with client/admin apps
- Runs independently on port 3002
- No Clerk dependency — fully public
</success_criteria>

<output>
After completion, create `.planning/phases/11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey/11.1-02-SUMMARY.md`
</output>
