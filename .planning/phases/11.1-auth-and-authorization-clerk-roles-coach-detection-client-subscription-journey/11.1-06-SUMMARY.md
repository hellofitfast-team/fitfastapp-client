---
phase: 11.1-auth-and-authorization-clerk-roles-coach-detection-client-subscription-journey
plan: "06"
subsystem: admin-panel
tags: [admin, signups, settings, plans, payment-methods, bilingual]
dependency_graph:
  requires: ["11.1-01", "11.1-04"]
  provides: [signup-detail-view, rejection-reason-flow, plans-manager, payment-methods-manager]
  affects: [admin-settings, admin-signups, marketing-landing-page]
tech_stack:
  added: []
  patterns:
    - Convex useQuery/useMutation for real-time data
    - Convex storage.getFileUrl for payment screenshot display
    - next-intl useTranslations with signupDetail and settings namespaces
    - Inline editing with local state + single save button pattern
key_files:
  created:
    - apps/admin/src/app/[locale]/(panel)/signups/[id]/page.tsx
    - apps/admin/src/app/[locale]/(panel)/settings/plans-manager.tsx
    - apps/admin/src/app/[locale]/(panel)/settings/payment-methods-manager.tsx
  modified:
    - apps/admin/src/app/[locale]/(panel)/signups/signups-table.tsx
    - apps/admin/src/app/[locale]/(panel)/settings/settings-form.tsx
    - apps/admin/src/messages/en.json
    - apps/admin/src/messages/ar.json
decisions:
  - Signup detail page uses api.storage.getFileUrl query to resolve payment screenshot from Convex storageId — avoids exposing raw storage IDs to client
  - Reject action in signups-table uses inline textarea expansion (not modal) — faster UX, no context switching
  - PlansManager uses local state initialized from server + single Save button — avoids partial saves on every keystroke
  - Max 4 plans enforced in UI only (business rule, not backend enforced)
  - Feature lists in PlansManager are paired EN/AR by index — both lists grow/shrink together to stay in sync
  - settings-form.tsx retains legacy pricing/instapay config sections (not removed) for backward compatibility
metrics:
  duration_minutes: 18
  tasks_completed: 2
  tasks_total: 2
  files_created: 3
  files_modified: 4
  completed_date: "2026-02-20"
---

# Phase 11.1 Plan 06: Admin Signup Detail + Plans & Payment Methods Manager Summary

**One-liner:** Admin signup detail page with payment screenshot display, rejection reason flow, and bilingual CRUD managers for pricing plans and payment methods.

## What Was Built

### Task 1: Signup Detail Page + Rejection Reason Flow

**`apps/admin/src/app/[locale]/(panel)/signups/[id]/page.tsx`** — Full signup detail page:
- Fetches signup via `useQuery(api.pendingSignups.getSignupById)`
- Resolves payment screenshot URL via `useQuery(api.storage.getFileUrl)` — shows actual image with click-to-zoom
- Displays OCR extracted data in labeled key-value format
- Approve button calls `approveSignup` mutation
- Reject button expands textarea for rejection reason — calls `rejectSignup` with `rejectionReason`
- Status badge shows current state; approved/rejected states hide action buttons
- If rejected, shows the rejection reason in a red banner

**`apps/admin/src/app/[locale]/(panel)/signups/signups-table.tsx`** (updated):
- Added "View Details" link per row navigating to `/signups/${signup._id}`
- Reject button now opens inline textarea for rejection reason before submitting
- Rejection reason is required — submit disabled until text entered
- Calls `rejectSignup({ signupId, rejectionReason })` instead of the old no-reason call

### Task 2: Plans Manager + Payment Methods Manager

**`apps/admin/src/app/[locale]/(panel)/settings/plans-manager.tsx`**:
- Loads current plans via `useQuery(api.systemConfig.getPlans)`
- Saves via `useMutation(api.systemConfig.updatePlans)`
- CRUD for up to 4 pricing plans with bilingual fields: name EN/AR, duration EN/AR, features EN/AR, badge EN/AR
- Features are dynamic lists (add/remove per plan)
- Badge is a dropdown: No Badge / Most Popular / Best Value (English and Arabic variants)
- Validation: name required, price > 0, at least 1 feature
- Sentry error tracking on save failure

**`apps/admin/src/app/[locale]/(panel)/settings/payment-methods-manager.tsx`**:
- Loads via `useQuery(api.systemConfig.getPaymentMethods)`
- Saves via `useMutation(api.systemConfig.updatePaymentMethods)`
- CRUD for payment methods: type (InstaPay/Vodafone Cash/etc.), account name, account number, instructions
- Two-click confirmation before remove to prevent accidental deletion

**`apps/admin/src/app/[locale]/(panel)/settings/settings-form.tsx`** (updated):
- Added Pricing Plans section (renders `<PlansManager />`)
- Added Payment Methods section (renders `<PaymentMethodsManager />`)
- All legacy sections (check-in frequency, plan pricing, InstaPay) retained

### i18n Updates

Both `en.json` and `ar.json` received:
- `signupDetail` namespace: all strings for detail page (backToList, paymentScreenshot, ocrData, approve, reject, statuses, etc.)
- `settings` namespace: all strings for plans and payment methods managers (addPlan, removePlan, savePlans, feature fields, badge options, payment method fields)
- `admin` namespace additions: viewDetails, payment, rejectionReasonLabel, confirmReject, cancelReject

## Commits

| Task | Commit | Description |
|------|--------|-------------|
| 1 | 87fb541 | feat(11.1-06): signup detail page and rejection reason flow |
| 2 | f37715f | feat(11.1-06): plans manager and payment methods manager in admin settings |

## Deviations from Plan

None — plan executed exactly as written.

## Self-Check: PASSED

All 7 files verified present. Both commits (87fb541, f37715f) verified in git log.
