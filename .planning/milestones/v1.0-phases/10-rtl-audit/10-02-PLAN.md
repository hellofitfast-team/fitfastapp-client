---
phase: 10-rtl-audit
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/utils/index.ts
  - src/app/[locale]/(dashboard)/page.tsx
  - src/app/[locale]/(dashboard)/tickets/page.tsx
  - src/app/[locale]/(dashboard)/tickets/[id]/page.tsx
  - src/app/[locale]/(dashboard)/check-in/_components/check-in-locked.tsx
  - src/app/[locale]/(dashboard)/settings/page.tsx
  - src/app/[locale]/(dashboard)/progress/page.tsx
  - src/app/[locale]/(dashboard)/progress/_components/stats-overview.tsx
  - src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx
  - src/app/[locale]/(admin)/admin/(panel)/signups/signups-table.tsx
  - src/app/[locale]/(admin)/admin/(panel)/tickets/tickets-list.tsx
  - src/app/[locale]/(admin)/admin/(panel)/clients/clients-list.tsx
  - src/app/[locale]/(admin)/admin/(panel)/clients/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dates display in Arabic format (day month year with Arabic month names) when locale is ar"
    - "Dates display in English format when locale is en"
    - "Numbers use Western Arabic numerals (0-9) in both locales for consistency"
    - "No hardcoded 'en-US' locale strings remain in any component"
  artifacts:
    - path: "src/lib/utils/index.ts"
      provides: "Locale-aware formatDate and formatNumber utility functions"
      contains: "ar-u-nu-latn"
    - path: "src/app/[locale]/(dashboard)/tickets/page.tsx"
      provides: "Locale-aware date display in ticket list"
      contains: "useLocale"
    - path: "src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx"
      provides: "Locale-aware dates in check-in history"
      contains: "formatDate"
    - path: "src/app/[locale]/(admin)/admin/(panel)/signups/signups-table.tsx"
      provides: "Locale-aware dates in admin signups"
      contains: "formatDate"
  key_links:
    - from: "src/app/[locale]/(dashboard)/tickets/page.tsx"
      to: "src/lib/utils/index.ts"
      via: "import { formatDate }"
      pattern: "formatDate"
    - from: "src/app/[locale]/(admin)/admin/(panel)/clients/[id]/page.tsx"
      to: "src/lib/utils/index.ts"
      via: "import { formatDate }"
      pattern: "formatDate"
---

<objective>
Replace all hardcoded locale strings with locale-aware date and number formatting throughout the application.

Purpose: Multiple components hardcode "en-US" in toLocaleDateString() calls or use bare toLocaleDateString() without any locale, causing English-formatted dates to appear in the Arabic interface. This breaks requirement RTL-03 (locale-aware formatting).

Output: All date and number displays use the user's current locale via utility functions or useLocale() hook.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-rtl-audit/10-RESEARCH.md
@src/lib/utils/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update utility functions for locale-aware formatting</name>
  <files>src/lib/utils/index.ts</files>
  <action>
    Update the existing `formatDate` and `formatNumber` functions in `src/lib/utils/index.ts`:

    1. **formatDate**: Change locale mapping to use `ar-u-nu-latn` instead of `ar-EG` for Arabic. This gives Arabic month names and date ordering while keeping Western numerals (0-9) for readability. Per research, Western numerals are preferred for this coach demo product.
       ```typescript
       export function formatDate(date: Date | string, locale: string = "en"): string {
         const d = typeof date === "string" ? new Date(date) : date;
         return d.toLocaleDateString(locale === "ar" ? "ar-u-nu-latn" : "en-US", {
           year: "numeric",
           month: "long",
           day: "numeric",
         });
       }
       ```

    2. **formatNumber**: Same change - use `ar-u-nu-latn` to keep Western numerals in Arabic.
       ```typescript
       export function formatNumber(num: number, locale: string = "en"): string {
         return num.toLocaleString(locale === "ar" ? "ar-u-nu-latn" : "en-US");
       }
       ```

    3. **Add new helper functions** for common patterns used across the app:
       ```typescript
       // Short date format (e.g., "Feb 15" / "١٥ فبراير")
       export function formatDateShort(date: Date | string, locale: string = "en"): string {
         const d = typeof date === "string" ? new Date(date) : date;
         return d.toLocaleDateString(locale === "ar" ? "ar-u-nu-latn" : "en-US", {
           month: "short",
           day: "numeric",
         });
       }

       // Date with weekday (e.g., "Sat, Feb 15" / "السبت، ١٥ فبراير")
       export function formatDateWithWeekday(date: Date | string, locale: string = "en"): string {
         const d = typeof date === "string" ? new Date(date) : date;
         return d.toLocaleDateString(locale === "ar" ? "ar-u-nu-latn" : "en-US", {
           weekday: "short",
           month: "short",
           day: "numeric",
         });
       }

       // Time format (e.g., "02:30 PM" / "٢:٣٠ م")
       export function formatTime(date: Date | string, locale: string = "en"): string {
         const d = typeof date === "string" ? new Date(date) : date;
         return d.toLocaleTimeString(locale === "ar" ? "ar-u-nu-latn" : "en-US", {
           hour: "2-digit",
           minute: "2-digit",
         });
       }
       ```
  </action>
  <verify>
    `pnpm tsc --noEmit` passes. Test the functions conceptually: `formatDate(new Date(), "ar")` should produce Arabic month names with Western numerals.
  </verify>
  <done>
    Utility functions in src/lib/utils/index.ts use `ar-u-nu-latn` for Arabic locale (Arabic text, Western numerals). New formatDateShort, formatDateWithWeekday, and formatTime helpers added.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace all hardcoded date/number formatting in pages</name>
  <files>
    src/app/[locale]/(dashboard)/page.tsx
    src/app/[locale]/(dashboard)/tickets/page.tsx
    src/app/[locale]/(dashboard)/tickets/[id]/page.tsx
    src/app/[locale]/(dashboard)/check-in/_components/check-in-locked.tsx
    src/app/[locale]/(dashboard)/settings/page.tsx
    src/app/[locale]/(dashboard)/progress/page.tsx
    src/app/[locale]/(dashboard)/progress/_components/stats-overview.tsx
    src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx
    src/app/[locale]/(admin)/admin/(panel)/signups/signups-table.tsx
    src/app/[locale]/(admin)/admin/(panel)/tickets/tickets-list.tsx
    src/app/[locale]/(admin)/admin/(panel)/clients/clients-list.tsx
    src/app/[locale]/(admin)/admin/(panel)/clients/[id]/page.tsx
  </files>
  <action>
    For each file, replace hardcoded date/number formatting with the utility functions from `src/lib/utils/index.ts`. Each file needs `useLocale()` from next-intl if it doesn't already have it, and import of the appropriate format function.

    **Dashboard page (`page.tsx`):**
    - Line 129: Replace `new Date().toLocaleDateString(locale === "ar" ? "ar-EG" : "en-US", { weekday: "short", month: "short", day: "numeric" }).toUpperCase()` with `formatDateWithWeekday(new Date(), locale).toUpperCase()`
    - Import: `import { formatDateWithWeekday } from "@/lib/utils";`

    **Tickets page (`tickets/page.tsx`):**
    - Line 112: Replace inline `date.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" })` with `formatDate(date, locale)`
    - Add `const locale = useLocale();` if not present, import `useLocale` from next-intl
    - Import: `import { formatDate } from "@/lib/utils";`

    **Ticket detail page (`tickets/[id]/page.tsx`):**
    - Line 91: Replace `date.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" })` with `formatDate(date, locale)`
    - Add `const locale = useLocale();` if not present
    - Import: `import { formatDate } from "@/lib/utils";`

    **Check-in locked (`check-in-locked.tsx`):**
    - Line 35: Replace `nextCheckInDate.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" })` with `formatDateWithWeekday(nextCheckInDate, locale)` (adjust format options if needed - this uses weekday: "long" so create the call inline with long format or extend the helper)
    - Actually, since this needs "long" weekday, use inline: `nextCheckInDate.toLocaleDateString(locale === "ar" ? "ar-u-nu-latn" : "en-US", { weekday: "long", month: "long", day: "numeric" })`
    - Add `const locale = useLocale();` and import

    **Settings page (`settings/page.tsx`):**
    - Line 101: Replace `endDate.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })` with `formatDate(endDate, locale)`
    - Add `const locale = useLocale();` if not present

    **Progress page (`progress/page.tsx`):**
    - Line 120: Replace `new Date(checkIn.created_at).toLocaleDateString("en-US", { month: "short", day: "numeric" })` with `formatDateShort(checkIn.created_at, locale)`
    - Line 131: Same replacement
    - Line 156: Replace bare `new Date(checkIn.created_at).toLocaleDateString()` with `formatDate(checkIn.created_at, locale)`
    - Import: `import { formatDateShort, formatDate } from "@/lib/utils";`

    **Stats overview (`stats-overview.tsx`):**
    - Line 33: Replace bare `new Date(firstCheckIn.created_at).toLocaleDateString()` with `formatDate(firstCheckIn.created_at, locale)`
    - Line 44: Same for latestCheckIn
    - Add `const locale = useLocale();` and imports

    **History tab (`history-tab.tsx`):**
    - Line 50: Replace `new Date(checkIn.created_at).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })` with `formatDate(checkIn.created_at, locale)`
    - Line 53: Replace `new Date(checkIn.created_at).toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" })` with `formatTime(checkIn.created_at, locale)`
    - Import: `import { formatDate, formatTime } from "@/lib/utils";`
    - Add `const locale = useLocale();`

    **Admin signups table (`signups-table.tsx`):**
    - Line 195: Replace bare `new Date(signup.created_at).toLocaleDateString()` with `formatDate(signup.created_at, locale)`
    - Add `const locale = useLocale();` and import

    **Admin tickets list (`tickets-list.tsx`):**
    - Line 134: Replace bare `new Date(ticket.created_at).toLocaleDateString()` with `formatDate(ticket.created_at, locale)`
    - Add `const locale = useLocale();` and import

    **Admin clients list (`clients-list.tsx`):**
    - Line 119: Replace bare `new Date(client.plan_end_date).toLocaleDateString()` with `formatDate(client.plan_end_date, locale)`
    - Add `const locale = useLocale();` and import

    **Admin client detail (`clients/[id]/page.tsx`):**
    - Lines 119, 127: Replace bare `new Date(...).toLocaleDateString()` with `formatDate(..., locale)`
    - Line 214: Same replacement for check-in dates
    - Add `const locale = useLocale();` and import

    **IMPORTANT:** For server components that don't have useLocale(), check if they already use `getLocale()` from next-intl/server. If a component is a server component (no "use client"), use `const locale = await getLocale()` from `next-intl/server` instead.

    **IMPORTANT:** Verify each file is "use client" or server before choosing useLocale() vs getLocale(). All the listed dashboard/admin page components are client components based on prior phase work.
  </action>
  <verify>
    `pnpm tsc --noEmit` passes.
    `grep -rn '"en-US"' src/app/ src/components/` should return zero results (no more hardcoded "en-US" anywhere).
    `grep -rn 'toLocaleDateString()' src/app/` should return zero results (no bare toLocaleDateString without locale).
  </verify>
  <done>
    All 12 page/component files use locale-aware date/number formatting. No hardcoded "en-US" strings remain. No bare toLocaleDateString() calls without locale parameter remain. Arabic interface shows Arabic-formatted dates with Western numerals.
  </done>
</task>

</tasks>

<verification>
- `pnpm tsc --noEmit` passes
- `grep -rn '"en-US"' src/app/ src/components/ src/lib/` returns zero matches
- `grep -rn '\.toLocaleDateString()' src/app/` returns zero bare calls (all have locale parameter)
- All date displays use formatDate/formatDateShort/formatDateWithWeekday/formatTime utilities
</verification>

<success_criteria>
Every date and number display in the application respects the user's locale. Arabic users see Arabic month names and date ordering. Western numerals (0-9) are used consistently in both locales for readability. No hardcoded "en-US" locale strings exist anywhere in the codebase.
</success_criteria>

<output>
After completion, create `.planning/phases/10-rtl-audit/10-02-SUMMARY.md`
</output>
