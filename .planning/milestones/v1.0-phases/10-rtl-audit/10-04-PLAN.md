---
phase: 10-rtl-audit
plan: 04
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/charts/ProgressCharts.tsx
  - src/app/[locale]/(dashboard)/tracking/_components/date-progress.tsx
  - src/app/[locale]/(dashboard)/tickets/page.tsx
  - src/app/[locale]/(dashboard)/tickets/[id]/page.tsx
  - src/app/[locale]/(dashboard)/settings/page.tsx
  - src/app/[locale]/(dashboard)/progress/_components/photos-tab.tsx
  - src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx
  - src/app/[locale]/(dashboard)/check-in/_components/step-navigation.tsx
  - src/app/[locale]/(admin)/admin/(panel)/page.tsx
  - src/app/[locale]/(admin)/admin/(panel)/clients/clients-list.tsx
  - src/app/[locale]/(admin)/admin/(panel)/clients/[id]/page.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/page.tsx
autonomous: true

must_haves:
  truths:
    - "Progress bars fill from right-to-left in Arabic (RTL) mode"
    - "Circular progress indicator renders correctly in RTL"
    - "Recharts weight chart stays left-to-right (time-series is universal)"
    - "Remaining directional icons in dashboard and admin pages flip correctly in RTL"
    - "Dashboard and admin page physical properties converted to logical"
  artifacts:
    - path: "src/components/charts/ProgressCharts.tsx"
      provides: "RTL-aware progress bars with dir attribute and LTR-wrapped chart"
      contains: "dir="
    - path: "src/app/[locale]/(dashboard)/tracking/_components/date-progress.tsx"
      provides: "RTL-aware circular progress indicator"
      contains: "useLocale"
    - path: "src/app/[locale]/(dashboard)/check-in/_components/step-navigation.tsx"
      provides: "RTL-aware step navigation arrows"
      contains: "rtl:rotate-180"
  key_links:
    - from: "src/components/charts/ProgressCharts.tsx"
      to: "next-intl useLocale"
      via: "locale detection for dir attribute"
      pattern: "useLocale"
    - from: "src/app/[locale]/(dashboard)/check-in/_components/step-navigation.tsx"
      to: "ArrowLeft/ArrowRight icons"
      via: "rtl:rotate-180 class"
      pattern: "rtl:rotate-180"
---

<objective>
Fix progress bars to respect RTL direction, wrap charts in LTR containers, add RTL rotation to remaining directional icons, and convert remaining physical properties in dashboard and admin pages.

Purpose: Progress bars use inline `width: X%` which always fills left-to-right regardless of document direction. In Arabic, progress should fill right-to-left. Time-series charts (weight trend) should remain LTR (universal). Multiple dashboard/admin pages still have physical directional properties.

Output: Progress indicators respect RTL direction. Charts wrapped in LTR. All remaining physical properties converted. All directional icons flip in RTL.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-rtl-audit/10-RESEARCH.md
@.planning/phases/10-rtl-audit/10-01-SUMMARY.md
@src/components/charts/ProgressCharts.tsx
@src/app/[locale]/(dashboard)/tracking/_components/date-progress.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: RTL-aware progress bars and LTR chart wrapping</name>
  <files>
    src/components/charts/ProgressCharts.tsx
    src/app/[locale]/(dashboard)/tracking/_components/date-progress.tsx
  </files>
  <action>
    **ProgressCharts.tsx - Linear progress bars (lines 108-110, 122-124):**

    1. Add `import { useLocale } from "next-intl";` (already has useTranslations)
    2. Add `const locale = useLocale();` in the component
    3. For each progress bar container (the `div` with `h-6 border-4 border-black bg-neutral-100`), add a `dir` attribute based on locale:
       ```tsx
       <div className="h-6 border-4 border-black bg-neutral-100" dir={locale === "ar" ? "rtl" : "ltr"}>
         <div
           className="h-full bg-success-500 transition-all"
           style={{
             width: `${adherenceStats.mealAdherence}%`,
             marginInlineStart: 0,
             marginInlineEnd: "auto"
           }}
         />
       </div>
       ```
    4. Apply same pattern to workout adherence bar (bg-primary).

    **ProgressCharts.tsx - Weight chart (Recharts):**
    5. Wrap the entire chart section (the `ResponsiveContainer` and its parent) in a `dir="ltr"` container to ensure time-series always flows left-to-right:
       ```tsx
       <div dir="ltr">
         <ResponsiveContainer width="100%" height={300}>
           ...
         </ResponsiveContainer>
       </div>
       ```
       This prevents the chart from being affected by the page's RTL direction.

    **DateProgress.tsx - Circular progress:**
    6. The circular SVG progress uses `strokeDashoffset` which is direction-neutral (it's a circle). However, the SVG uses `-rotate-90 transform` to start from the top. In RTL, the circle fills counterclockwise which is actually correct (right-to-left = counterclockwise from top). No changes needed for the circle itself, but verify by adding `useLocale` import and a comment explaining the decision:
       ```tsx
       // Circular progress: No RTL flip needed. Circle fills counterclockwise
       // from top in both LTR and RTL, which is the expected behavior.
       ```
    7. Add `useLocale` import to DateProgress.tsx for future use and to confirm locale awareness.
  </action>
  <verify>
    `pnpm tsc --noEmit` passes.
    `grep -n "dir=" src/components/charts/ProgressCharts.tsx` shows dir attributes on progress bar containers and chart wrapper.
  </verify>
  <done>
    Linear progress bars fill from the correct direction (RTL in Arabic, LTR in English). Weight chart always displays left-to-right. Circular progress confirmed as direction-neutral.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remaining physical properties and directional icons in dashboard and admin</name>
  <files>
    src/app/[locale]/(dashboard)/tickets/page.tsx
    src/app/[locale]/(dashboard)/tickets/[id]/page.tsx
    src/app/[locale]/(dashboard)/settings/page.tsx
    src/app/[locale]/(dashboard)/progress/_components/photos-tab.tsx
    src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx
    src/app/[locale]/(dashboard)/check-in/_components/step-navigation.tsx
    src/app/[locale]/(admin)/admin/(panel)/page.tsx
    src/app/[locale]/(admin)/admin/(panel)/clients/clients-list.tsx
    src/app/[locale]/(admin)/admin/(panel)/clients/[id]/page.tsx
    src/app/[locale]/(onboarding)/initial-assessment/page.tsx
  </files>
  <action>
    **Physical property conversions:**

    **tickets/page.tsx (line ~185):**
    - `pr-10` to `pe-10` (select dropdown padding for chevron icon)
    - ChevronRight icon (line ~341): Add `rtl:rotate-180` - this is a "view ticket" navigation chevron

    **tickets/[id]/page.tsx:**
    - ArrowLeft icons (lines ~134, ~159): Add `rtl:rotate-180` - these are "back" navigation arrows

    **settings/page.tsx (line ~182):**
    - `pr-10` to `pe-10` (select dropdown padding)

    **photos-tab.tsx (line ~52):**
    - `left-0 right-0` to `inset-x-0` (already works in both directions since it spans full width - `left-0 right-0` is the same as `inset-x-0`). Actually `left-0 right-0` IS bidirectional (it means both left and right are 0), so it works in RTL. Keep as-is OR simplify to `inset-x-0` for clarity.

    **history-tab.tsx (line ~59):**
    - `ml-1` to `ms-1` (spacing between weight value and unit)

    **step-navigation.tsx (check-in):**
    - ArrowLeft icon (line ~26): Add `rtl:rotate-180` to flip "back" arrow
    - ArrowRight icon (line ~38): Add `rtl:rotate-180` to flip "next" arrow

    **admin panel page (page.tsx):**
    - ArrowRight icon (line ~96): Add `rtl:rotate-180` to "View" link arrows

    **admin clients list (clients-list.tsx):**
    - ArrowRight icon (line ~127): Add `rtl:rotate-180` to "view client" arrows

    **admin client detail (clients/[id]/page.tsx):**
    - ArrowLeft icon (line ~58): Add `rtl:rotate-180` to "back" arrow

    **initial-assessment/page.tsx:**
    - ArrowRight icon (line ~247): Add `rtl:rotate-180` to "submit" arrow

    **Summary of icon flipping rules applied:**
    - ArrowRight (forward/submit/view): `rtl:rotate-180`
    - ArrowLeft (back/return): `rtl:rotate-180`
    - ChevronRight (navigate to detail): `rtl:rotate-180`
    - ChevronDown (expand/dropdown): NO flip (vertical = universal)
    - Check, Loader2, Send, Upload: NO flip (non-directional)
  </action>
  <verify>
    `pnpm tsc --noEmit` passes.
    `grep -rn "ArrowRight\|ArrowLeft\|ChevronRight" src/app/ | grep -v "rtl:rotate-180" | grep -v "import\|from\|ChevronDown"` should show zero results (all directional icons have rtl:rotate-180 except in import lines).
    Actually, a simpler check: `grep -rn "rtl:rotate-180" src/app/` should show matches for all directional icon usages.
  </verify>
  <done>
    All remaining physical properties in dashboard/admin pages converted to logical. All directional icons (ArrowRight, ArrowLeft, ChevronRight) flip in RTL. Non-directional icons (ChevronDown, Check, etc.) correctly left unchanged.
  </done>
</task>

</tasks>

<verification>
- `pnpm tsc --noEmit` passes
- Progress bars in ProgressCharts.tsx have `dir` attribute
- Weight chart wrapped in `dir="ltr"` container
- All ArrowRight/ArrowLeft/ChevronRight icons have `rtl:rotate-180`
- `grep -rn "\\bml-\\|\\bmr-\\|\\bpr-" src/app/\[locale\]/\(dashboard\)/ src/app/\[locale\]/\(admin\)/` returns only false positives (e.g., className variables, not actual physical properties in rendered output)
</verification>

<success_criteria>
Progress indicators visually fill from the correct direction based on locale. Time-series charts remain LTR. All directional navigation icons flip correctly in RTL. No physical directional properties remain in dashboard or admin page code.
</success_criteria>

<output>
After completion, create `.planning/phases/10-rtl-audit/10-04-SUMMARY.md`
</output>
