---
phase: 08-component-refactoring
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[locale]/(dashboard)/tracking/_components/tracking-header.tsx
  - src/app/[locale]/(dashboard)/tracking/_components/date-progress.tsx
  - src/app/[locale]/(dashboard)/tracking/_components/meal-tracking.tsx
  - src/app/[locale]/(dashboard)/tracking/_components/workout-tracking.tsx
  - src/app/[locale]/(dashboard)/tracking/_components/daily-reflection.tsx
  - src/app/[locale]/(dashboard)/tracking/_components/tracking-skeleton.tsx
  - src/app/[locale]/(dashboard)/tracking/page.tsx
autonomous: true

must_haves:
  truths:
    - "Tracking page renders identically before and after refactor"
    - "Meal completion toggling works with loading state"
    - "Workout completion toggling works with loading state"
    - "Daily reflection form saves correctly"
    - "Date picker changes update all sections"
    - "tracking/page.tsx is under 400 lines"
  artifacts:
    - path: "src/app/[locale]/(dashboard)/tracking/_components/meal-tracking.tsx"
      provides: "Meal tracking section with toggle and notes"
    - path: "src/app/[locale]/(dashboard)/tracking/_components/workout-tracking.tsx"
      provides: "Workout tracking section with toggle and notes"
    - path: "src/app/[locale]/(dashboard)/tracking/_components/daily-reflection.tsx"
      provides: "Daily reflection form"
    - path: "src/app/[locale]/(dashboard)/tracking/_components/tracking-skeleton.tsx"
      provides: "Full-page skeleton loading state"
    - path: "src/app/[locale]/(dashboard)/tracking/page.tsx"
      provides: "Orchestration-only page under 400 lines"
  key_links:
    - from: "page.tsx"
      to: "_components/meal-tracking.tsx"
      via: "passes todaysMeals, trackingData, toggle handler as props"
      pattern: "MealTracking"
    - from: "page.tsx"
      to: "_components/workout-tracking.tsx"
      via: "passes todaysWorkout, trackingData, toggle handler as props"
      pattern: "WorkoutTracking"
---

<objective>
Split the 547-line tracking page into focused sub-components for each major section (meals, workouts, reflection, skeleton).

Purpose: The tracking page has 4 distinct visual sections plus a large skeleton loading state. Each section has independent interactivity (meal toggling, workout toggling, reflection form). Splitting makes each section maintainable and the skeleton reusable.

Output: tracking/page.tsx reduced to ~150-200 lines, 6 sub-components in _components/.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-component-refactoring/08-RESEARCH.md
@src/app/[locale]/(dashboard)/tracking/page.tsx
@src/hooks/use-tracking.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tracking sub-components</name>
  <files>
    src/app/[locale]/(dashboard)/tracking/_components/tracking-header.tsx
    src/app/[locale]/(dashboard)/tracking/_components/date-progress.tsx
    src/app/[locale]/(dashboard)/tracking/_components/meal-tracking.tsx
    src/app/[locale]/(dashboard)/tracking/_components/workout-tracking.tsx
    src/app/[locale]/(dashboard)/tracking/_components/daily-reflection.tsx
    src/app/[locale]/(dashboard)/tracking/_components/tracking-skeleton.tsx
  </files>
  <action>
    1. Create `_components/tracking-header.tsx`:
       - Extract the header block (black bg with Target icon, title, subtitle) — used in both main view and empty state
       - Props: none (uses useTranslations internally)
       - "use client" with useTranslations("tracking")

    2. Create `_components/date-progress.tsx`:
       - Extract the date picker + completion progress grid (lines 287-341)
       - Props: `{ selectedDate: string, onDateChange: (date: string) => void, completionPercentage: number }`
       - "use client" with useTranslations("tracking")
       - Contains the SVG circular progress ring

    3. Create `_components/meal-tracking.tsx`:
       - Extract the entire meal tracking collapsible section (lines 343-425)
       - Props: `{ todaysMeals: Meal[], mealCompletions: MealCompletion[], isTogglingMeal: number | null, mealNotes: Record<number, string>, onMealToggle: (index: number, completed: boolean) => void, onMealNotesChange: (notes: Record<number, string>) => void, isMealsExpanded: boolean, onToggleExpand: () => void }`
       - "use client" with useTranslations for "tracking" and "meals"
       - getMealCompletion helper can be inline in this component

    4. Create `_components/workout-tracking.tsx`:
       - Extract the entire workout tracking collapsible section (lines 427-515)
       - Props: `{ todaysWorkout: WorkoutDay | undefined, workoutCompletions: WorkoutCompletion[], isTogglingWorkout: number | null, workoutNotes: Record<number, string>, onWorkoutToggle: (index: number, completed: boolean) => void, onWorkoutNotesChange: (notes: Record<number, string>) => void, isWorkoutsExpanded: boolean, onToggleExpand: () => void }`
       - "use client" with useTranslations for "tracking", "workouts", "common"
       - getWorkoutCompletion helper can be inline here

    5. Create `_components/daily-reflection.tsx`:
       - Extract the daily reflection form section (lines 517-544)
       - Props: `{ defaultReflection: string, onSubmit: (data: { reflection: string }) => void }`
       - "use client" — uses its own useForm<ReflectionForm> internally (self-contained form)
       - Include the useEffect that resets form when default value changes

    6. Create `_components/tracking-skeleton.tsx`:
       - Extract the entire skeleton loading state (lines 156-229)
       - No props needed, purely presentational
       - "use client" with Skeleton import from @/components/ui/skeleton

    For meal/workout types, import GeneratedMealPlan and GeneratedWorkoutPlan from the existing type locations. The meal type for todaysMeals items can be inferred from `GeneratedMealPlan["weeklyPlan"][string]["meals"][number]` or use a simpler inline type.

    All components must preserve existing Tailwind classes, expand/collapse behavior, and i18n patterns exactly.
  </action>
  <verify>
    `ls src/app/[locale]/(dashboard)/tracking/_components/` shows 6 files.
    All files have "use client" directive and appropriate imports.
  </verify>
  <done>All 6 tracking sub-components created with correct props and preserved styling</done>
</task>

<task type="auto">
  <name>Task 2: Refactor tracking page.tsx to use imported sub-components</name>
  <files>
    src/app/[locale]/(dashboard)/tracking/page.tsx
  </files>
  <action>
    Rewrite tracking/page.tsx as an orchestration component:

    1. Keep: "use client", all hook calls (useAuth, useCurrentMealPlan, useCurrentWorkoutPlan, useTracking), all state (selectedDate, isMealsExpanded, isWorkoutsExpanded, mealNotes, workoutNotes, isTogglingMeal, isTogglingWorkout)
    2. Keep: handler functions (handleMealToggle, handleWorkoutToggle, onReflectionSubmit), computed values (completionPercentage, dayName, todaysMeals, todaysWorkout)
    3. Remove: all JSX for skeleton, header, date picker, meal section, workout section, reflection section
    4. Import: TrackingHeader, DateProgress, MealTracking, WorkoutTracking, DailyReflection, TrackingSkeleton from ./_components/

    The page should:
    - Show TrackingSkeleton during loading
    - Show TrackingHeader + EmptyState when no plans
    - Show TrackingHeader + DateProgress + MealTracking + WorkoutTracking + DailyReflection for normal view
    - Pass appropriate props to each component

    Target: page.tsx should be approximately 150-200 lines (state + hooks + handlers + component composition).

    After refactoring, run `pnpm tsc --noEmit` to verify no TypeScript errors.
    Then run `pnpm build` to verify the build succeeds.
  </action>
  <verify>
    `wc -l src/app/[locale]/(dashboard)/tracking/page.tsx` shows under 400 lines.
    `pnpm tsc --noEmit` passes.
    `pnpm build` succeeds.
  </verify>
  <done>tracking/page.tsx under 400 lines, all sections delegated to sub-components, TypeScript clean, build succeeds</done>
</task>

</tasks>

<verification>
- `wc -l src/app/[locale]/(dashboard)/tracking/page.tsx` < 400
- `ls src/app/[locale]/(dashboard)/tracking/_components/` shows 6 files
- `pnpm tsc --noEmit` passes
- `pnpm build` succeeds
</verification>

<success_criteria>
- Tracking page reduced from 547 to under 400 lines
- All visual sections extracted to _components/ with clear props
- Skeleton loading state extracted as reusable component
- No TypeScript errors, build succeeds
- Functionality preserved (date selection, meal/workout toggling, reflection saving)
</success_criteria>

<output>
After completion, create `.planning/phases/08-component-refactoring/08-03-SUMMARY.md`
</output>
