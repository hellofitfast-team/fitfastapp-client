---
phase: 08-component-refactoring
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/brutalist-multi-select.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/_components/goals-section.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/_components/basic-info-section.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/_components/schedule-section.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/_components/dietary-section.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/_components/medical-section.tsx
  - src/app/[locale]/(onboarding)/initial-assessment/page.tsx
autonomous: true

must_haves:
  truths:
    - "Initial assessment page renders identically before and after refactor"
    - "Form submission saves all fields correctly to initial_assessments table"
    - "BrutalistMultiSelect component is reusable from shared location"
    - "initial-assessment/page.tsx is under 400 lines"
  artifacts:
    - path: "src/components/ui/brutalist-multi-select.tsx"
      provides: "Reusable multi-select checkbox component"
      exports: ["BrutalistMultiSelect"]
    - path: "src/app/[locale]/(onboarding)/initial-assessment/_components/goals-section.tsx"
      provides: "Fitness goals form section"
    - path: "src/app/[locale]/(onboarding)/initial-assessment/_components/basic-info-section.tsx"
      provides: "Weight, height, experience level, equipment sections"
    - path: "src/app/[locale]/(onboarding)/initial-assessment/_components/schedule-section.tsx"
      provides: "Weekly schedule day picker"
    - path: "src/app/[locale]/(onboarding)/initial-assessment/_components/dietary-section.tsx"
      provides: "Food preferences, allergies, dietary restrictions"
    - path: "src/app/[locale]/(onboarding)/initial-assessment/page.tsx"
      provides: "Orchestration-only page under 400 lines"
  key_links:
    - from: "_components/*.tsx"
      to: "src/components/ui/brutalist-multi-select.tsx"
      via: "import BrutalistMultiSelect"
      pattern: "BrutalistMultiSelect"
    - from: "page.tsx"
      to: "_components/*.tsx"
      via: "imports and renders sections with props"
      pattern: "import.*from.*_components"
---

<objective>
Split the 594-line initial-assessment page into focused sub-components and extract the BrutalistMultiSelect to a shared UI component.

Purpose: The initial assessment form has 7 distinct form sections and an inline BrutalistMultiSelect component that should be reusable. Splitting reduces page.tsx to orchestration-only while making the multi-select available for future use.

Output: initial-assessment/page.tsx reduced to ~200-250 lines, 5 section components in _components/, BrutalistMultiSelect moved to shared UI.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-component-refactoring/08-RESEARCH.md
@src/app/[locale]/(onboarding)/initial-assessment/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract BrutalistMultiSelect and create assessment sub-components</name>
  <files>
    src/components/ui/brutalist-multi-select.tsx
    src/app/[locale]/(onboarding)/initial-assessment/_components/goals-section.tsx
    src/app/[locale]/(onboarding)/initial-assessment/_components/basic-info-section.tsx
    src/app/[locale]/(onboarding)/initial-assessment/_components/schedule-section.tsx
    src/app/[locale]/(onboarding)/initial-assessment/_components/dietary-section.tsx
    src/app/[locale]/(onboarding)/initial-assessment/_components/medical-section.tsx
  </files>
  <action>
    1. Create `src/components/ui/brutalist-multi-select.tsx`:
       - Move the BrutalistMultiSelect function component (lines 75-160 of current page) to shared UI
       - "use client" directive at top
       - Export the component and its props type
       - Keep exact same props interface: options, selected, onChange, otherValue, onOtherChange, disabled, columns, hasNoneOption
       - Import Check from lucide-react

    2. Move the constant arrays (FITNESS_GOALS, FOOD_PREFERENCES, COMMON_ALLERGIES, DIETARY_RESTRICTIONS, EQUIPMENT_OPTIONS, DAYS) to a `_components/constants.ts` file (no "use client" needed — pure data).

    3. Create `_components/goals-section.tsx`:
       - Extract the "Fitness Goals" section (lines 334-350)
       - Props: `{ selectedGoals, setSelectedGoals, goalsOther, setGoalsOther, isLoading }`
       - "use client", imports BrutalistMultiSelect from @/components/ui/brutalist-multi-select
       - Import FITNESS_GOALS from ./constants

    4. Create `_components/basic-info-section.tsx`:
       - Combine "Basic Information" (weight/height, lines 352-394), "Experience Level" (lines 396-425), and "Available Equipment" (lines 427-460) into one component
       - Props: `{ currentWeight, setCurrentWeight, height, setHeight, experienceLevel, setExperienceLevel, equipment, setEquipment, equipmentOther, setEquipmentOther, isLoading }`
       - These are logically related (personal fitness profile) and short individually

    5. Create `_components/schedule-section.tsx`:
       - Extract "Weekly Schedule" day picker (lines 462-501)
       - Props: `{ selectedDays, setSelectedDays, isLoading }`
       - Import DAYS from ./constants

    6. Create `_components/dietary-section.tsx`:
       - Combine "Food Preferences" (lines 504-520), "Food Allergies" (lines 522-539), and "Dietary Restrictions" (lines 541-557) into one component
       - Props: `{ selectedFoodPrefs, setSelectedFoodPrefs, foodPrefsOther, setFoodPrefsOther, selectedAllergies, setSelectedAllergies, allergiesOther, setAllergiesOther, selectedRestrictions, setSelectedRestrictions, restrictionsOther, setRestrictionsOther, isLoading }`
       - These three sections share the same BrutalistMultiSelect pattern and are diet-related

    7. Create `_components/medical-section.tsx`:
       - Extract "Medical Notes" (lines 559-574)
       - Props: `{ medicalNotes, setMedicalNotes, isLoading }`

    All components must preserve existing Tailwind classes exactly. All "use client" where needed.
  </action>
  <verify>
    All new files exist:
    - `ls src/components/ui/brutalist-multi-select.tsx`
    - `ls src/app/[locale]/(onboarding)/initial-assessment/_components/*.tsx`
    - `ls src/app/[locale]/(onboarding)/initial-assessment/_components/constants.ts`
  </verify>
  <done>BrutalistMultiSelect extracted to shared UI, 5 section components + constants file created in _components/</done>
</task>

<task type="auto">
  <name>Task 2: Refactor initial-assessment page.tsx to use imported sub-components</name>
  <files>
    src/app/[locale]/(onboarding)/initial-assessment/page.tsx
  </files>
  <action>
    Rewrite initial-assessment/page.tsx as an orchestration component:

    1. Keep: "use client", router, auth, form state (all useState hooks), validation logic (onSubmit), loading/error state
    2. Remove: BrutalistMultiSelect definition (now in shared UI), all constant arrays (now in constants.ts), all section JSX
    3. Import: All section components from ./_components/, BrutalistMultiSelect no longer needed here

    The page should:
    - Manage all form state via useState (no FormProvider needed — this form uses simple controlled inputs, not react-hook-form)
    - Keep getFinalValues helper and onSubmit handler
    - Render: header, error banner, GoalsSection, BasicInfoSection, ScheduleSection, DietarySection, MedicalSection, submit button
    - Pass state + setters as props to each section

    Target: page.tsx should be approximately 200-250 lines.

    After refactoring, run `pnpm tsc --noEmit` to verify no TypeScript errors.
    Then run `pnpm build` to verify the build succeeds.
  </action>
  <verify>
    `wc -l src/app/[locale]/(onboarding)/initial-assessment/page.tsx` shows under 400 lines.
    `pnpm tsc --noEmit` passes.
    `pnpm build` succeeds.
  </verify>
  <done>initial-assessment/page.tsx under 400 lines, BrutalistMultiSelect is shared component, all sections delegated, TypeScript clean, build succeeds</done>
</task>

</tasks>

<verification>
- `wc -l src/app/[locale]/(onboarding)/initial-assessment/page.tsx` < 400
- `ls src/app/[locale]/(onboarding)/initial-assessment/_components/` shows 6+ files
- `ls src/components/ui/brutalist-multi-select.tsx` exists
- `pnpm tsc --noEmit` passes
- `pnpm build` succeeds
</verification>

<success_criteria>
- Initial assessment page reduced from 594 to under 400 lines
- BrutalistMultiSelect extracted to shared ui/ location for reuse
- All form sections extracted to _components/
- No TypeScript errors, build succeeds
- Functionality preserved (validation, submission, plan generation)
</success_criteria>

<output>
After completion, create `.planning/phases/08-component-refactoring/08-02-SUMMARY.md`
</output>
