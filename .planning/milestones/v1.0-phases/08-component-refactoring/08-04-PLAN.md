---
phase: 08-component-refactoring
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[locale]/(dashboard)/progress/_components/stats-overview.tsx
  - src/app/[locale]/(dashboard)/progress/_components/photos-tab.tsx
  - src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx
  - src/app/[locale]/(dashboard)/progress/_components/progress-skeleton.tsx
  - src/app/[locale]/(dashboard)/progress/page.tsx
autonomous: true

must_haves:
  truths:
    - "Progress page renders identically before and after refactor"
    - "Date range filter updates charts, photos, and history"
    - "Photo modal opens and closes correctly"
    - "Tab switching between charts, photos, and history works"
    - "progress/page.tsx is under 400 lines"
  artifacts:
    - path: "src/app/[locale]/(dashboard)/progress/_components/stats-overview.tsx"
      provides: "Weight stats grid (start, current, change, check-in count)"
    - path: "src/app/[locale]/(dashboard)/progress/_components/photos-tab.tsx"
      provides: "Progress photos grid with photo modal"
    - path: "src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx"
      provides: "Check-in history list with measurements"
    - path: "src/app/[locale]/(dashboard)/progress/_components/progress-skeleton.tsx"
      provides: "Full-page skeleton loading state"
    - path: "src/app/[locale]/(dashboard)/progress/page.tsx"
      provides: "Orchestration-only page under 400 lines"
  key_links:
    - from: "page.tsx"
      to: "_components/photos-tab.tsx"
      via: "passes allPhotos array as prop"
      pattern: "PhotosTab"
    - from: "page.tsx"
      to: "_components/history-tab.tsx"
      via: "passes filteredCheckIns as prop"
      pattern: "HistoryTab"
---

<objective>
Split the 495-line progress page into focused sub-components for the stats grid, photo gallery, and history list.

Purpose: The progress page has 3 distinct tab contents (charts, photos, history) plus a stats overview and skeleton state. Each tab is independent and the page exceeds 400 lines. Splitting makes each tab maintainable.

Output: progress/page.tsx reduced to ~200-250 lines, 4 sub-components in _components/.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-component-refactoring/08-RESEARCH.md
@src/app/[locale]/(dashboard)/progress/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create progress sub-components</name>
  <files>
    src/app/[locale]/(dashboard)/progress/_components/stats-overview.tsx
    src/app/[locale]/(dashboard)/progress/_components/photos-tab.tsx
    src/app/[locale]/(dashboard)/progress/_components/history-tab.tsx
    src/app/[locale]/(dashboard)/progress/_components/progress-skeleton.tsx
  </files>
  <action>
    1. Create `_components/stats-overview.tsx`:
       - Extract the 4-column stats grid (lines 260-308)
       - Props: `{ firstCheckIn: CheckIn | undefined, latestCheckIn: CheckIn | undefined, weightChange: number, weightChangePercent: string, totalCheckIns: number }`
       - "use client" with useTranslations("progress")
       - Import Weight, TrendingDown, TrendingUp, Calendar from lucide-react

    2. Create `_components/photos-tab.tsx`:
       - Extract the photos tab content (lines 338-388) AND the photo modal (lines 479-492)
       - This component manages its own selectedPhoto state internally
       - Props: `{ photos: Array<{ url: string; date: string }> }`
       - "use client" with useTranslations("progress"), EmptyState import
       - Import Image from next/image
       - Include the photo modal overlay inside this component

    3. Create `_components/history-tab.tsx`:
       - Extract the history tab content (lines 391-476)
       - Props: `{ checkIns: CheckIn[] }`
       - "use client" with useTranslations for "progress", "checkIn", "units"
       - Import EmptyState, Calendar from respective locations
       - Contains the MeasurementData type locally or import from parent

    4. Create `_components/progress-skeleton.tsx`:
       - Extract the skeleton loading state (lines 176-222)
       - No props, purely presentational
       - "use client" with Skeleton import

    All components preserve existing Tailwind classes, EmptyState patterns, and i18n usage exactly.
  </action>
  <verify>
    `ls src/app/[locale]/(dashboard)/progress/_components/` shows 4 files.
    All files have proper "use client" and imports.
  </verify>
  <done>All 4 progress sub-components created with correct props and preserved styling</done>
</task>

<task type="auto">
  <name>Task 2: Refactor progress page.tsx to use imported sub-components</name>
  <files>
    src/app/[locale]/(dashboard)/progress/page.tsx
  </files>
  <action>
    Rewrite progress/page.tsx as an orchestration component:

    1. Keep: "use client", data fetching functions (fetchCheckIns, fetchAdherenceStats, getCurrentUser), SWR calls, dateRange state, activeTab state, useMemo computations (filteredCheckIns, weightChartData, measurementChartData, allPhotos, weight calculations)
    2. Remove: all skeleton JSX, stats grid JSX, photos tab JSX, history tab JSX, photo modal JSX, selectedPhoto state (moves to PhotosTab)
    3. Import: StatsOverview, PhotosTab, HistoryTab, ProgressSkeleton from ./_components/

    The page should:
    - Show ProgressSkeleton during loading
    - Render header with date range filter buttons
    - Render StatsOverview with computed weight data
    - Render tab buttons
    - Conditionally render: ProgressCharts (existing dynamic import), PhotosTab, or HistoryTab based on activeTab

    Target: page.tsx should be approximately 200-250 lines (data fetching + computations + composition).

    After refactoring, run `pnpm tsc --noEmit` to verify no TypeScript errors.
    Then run `pnpm build` to verify the build succeeds.
  </action>
  <verify>
    `wc -l src/app/[locale]/(dashboard)/progress/page.tsx` shows under 400 lines.
    `pnpm tsc --noEmit` passes.
    `pnpm build` succeeds.
  </verify>
  <done>progress/page.tsx under 400 lines, tabs delegated to sub-components, photo modal moved to PhotosTab, TypeScript clean, build succeeds</done>
</task>

</tasks>

<verification>
- `wc -l src/app/[locale]/(dashboard)/progress/page.tsx` < 400
- `ls src/app/[locale]/(dashboard)/progress/_components/` shows 4 files
- `pnpm tsc --noEmit` passes
- `pnpm build` succeeds
</verification>

<success_criteria>
- Progress page reduced from 495 to under 400 lines
- Photo modal encapsulated within PhotosTab (cleaner separation)
- Stats overview, photos, and history extracted to _components/
- No TypeScript errors, build succeeds
- Functionality preserved (date filtering, tab switching, photo modal, history display)
</success_criteria>

<output>
After completion, create `.planning/phases/08-component-refactoring/08-04-SUMMARY.md`
</output>
