---
phase: 06-ux-polish
plan: 04
type: execute
wave: 3
depends_on: ["06-02", "06-03"]
files_modified:
  - src/app/[locale]/(dashboard)/tickets/page.tsx
  - src/app/[locale]/(dashboard)/settings/page.tsx
autonomous: true

must_haves:
  truths:
    - "Tickets form validates subject on blur with inline error message"
    - "Tickets form uses React Hook Form with Zod resolver in onBlur mode"
    - "Settings profile form validates full name and phone on blur with inline error messages"
    - "Settings profile form uses React Hook Form with Zod resolver in onBlur mode"
    - "Error messages have aria-invalid and role=alert for accessibility"
    - "Error border uses border-error-500 class consistent with design system"
  artifacts:
    - path: "src/app/[locale]/(dashboard)/tickets/page.tsx"
      provides: "React Hook Form + Zod validated ticket form"
      contains: "useForm"
    - path: "src/app/[locale]/(dashboard)/settings/page.tsx"
      provides: "React Hook Form + Zod validated settings profile form"
      contains: "useForm"
  key_links:
    - from: "src/app/[locale]/(dashboard)/tickets/page.tsx"
      to: "react-hook-form"
      via: "useForm import"
      pattern: "import.*useForm.*from.*react-hook-form"
    - from: "src/app/[locale]/(dashboard)/tickets/page.tsx"
      to: "@hookform/resolvers/zod"
      via: "zodResolver import"
      pattern: "import.*zodResolver.*from.*hookform/resolvers/zod"
---

<objective>
Upgrade the tickets form and settings profile form from manual useState validation to React Hook Form with Zod schemas and inline error messages on blur.

Purpose: Inline validation on blur gives users immediate feedback without waiting for form submission. Consistent error display with ARIA attributes ensures accessibility. This covers UX-03 requirement.

Output: Two forms upgraded with React Hook Form + Zod, onBlur validation, inline error messages, and ARIA accessibility.
</objective>

<execution_context>
@/Users/ziadadel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ziadadel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-ux-polish/06-RESEARCH.md
@.planning/phases/06-ux-polish/06-01-SUMMARY.md
@src/app/[locale]/(dashboard)/tickets/page.tsx
@src/app/[locale]/(dashboard)/settings/page.tsx
@src/app/[locale]/(dashboard)/check-in/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade tickets form to React Hook Form + Zod</name>
  <files>src/app/[locale]/(dashboard)/tickets/page.tsx</files>
  <action>
Read the full file first. The tickets page has a form with subject, category, description, and screenshot fields using manual useState.

**Add imports:**
```tsx
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { cn } from "@/lib/utils";
```

**Define Zod schema** at the top of the file (outside the component):
```tsx
const ticketSchema = z.object({
  subject: z.string().min(3, "Subject must be at least 3 characters").max(100, "Subject must be under 100 characters"),
  category: z.enum(["meal_issue", "workout_issue", "technical", "bug_report", "other"]),
  description: z.string().optional(),
});
type TicketFormData = z.infer<typeof ticketSchema>;
```

**Replace manual form state** with React Hook Form:
- Remove `useState` for `subject`, `selectedCategory`, `description` (keep `screenshotFile`, `isUploading`, `submitSuccess`)
- Add `useForm`:
  ```tsx
  const { register, handleSubmit, formState: { errors, isSubmitting }, reset, watch } = useForm<TicketFormData>({
    resolver: zodResolver(ticketSchema),
    mode: "onBlur",
    reValidateMode: "onBlur",
    defaultValues: {
      subject: "",
      category: "meal_issue",
      description: "",
    },
  });
  ```

**Update handleSubmit:**
- Rename existing `handleSubmit` to `onSubmit` (receives validated `data: TicketFormData`)
- Remove the manual `if (!subject.trim()) return` check (Zod handles this)
- Use `data.subject`, `data.category`, `data.description` instead of state variables
- Replace `isCreating` with `isSubmitting` from formState
- On success, call `reset()` to clear the form

**Update form JSX:**
- Change `<form onSubmit={handleSubmit}>` to `<form onSubmit={handleSubmit(onSubmit)}>`
- **Subject input:** Replace `value={subject} onChange={(e) => setSubject(e.target.value)}` with `{...register("subject")}`
  - Add `className={cn("w-full h-12 px-4 border-4 border-black bg-cream ...", errors.subject && "border-error-500")}`
  - Add `aria-invalid={errors.subject ? "true" : "false"}`
  - Add error display below input:
    ```tsx
    {errors.subject && (
      <p className="mt-1 font-mono text-xs text-error-500" role="alert">
        {errors.subject.message}
      </p>
    )}
    ```
- **Category select:** Replace `value={selectedCategory} onChange={(e) => setSelectedCategory(...)}` with `{...register("category")}`
- **Description textarea:** Replace `value={description} onChange={(e) => setDescription(e.target.value)}` with `{...register("description")}`
- **Submit button:** Replace `disabled={isCreating || isUploading || !subject.trim()}` with `disabled={isSubmitting || isUploading}`
  - Replace `isCreating` references in button text with `isSubmitting`
- **All disabled={isCreating}** on inputs: Replace with `disabled={isSubmitting}`

Keep the screenshot file upload as-is (separate from form schema since it's a File object, not serializable).
  </action>
  <verify>`pnpm tsc --noEmit 2>&1 | head -20` to verify TypeScript compiles. Grep: `grep -n "useForm\|zodResolver\|errors\.\|aria-invalid\|border-error" src/app/[locale]/(dashboard)/tickets/page.tsx`</verify>
  <done>Tickets form uses React Hook Form + Zod with onBlur validation. Subject field shows inline error when less than 3 characters. Category validates as enum. Errors display with error-500 border and font-mono text. ARIA attributes present.</done>
</task>

<task type="auto">
  <name>Task 2: Upgrade settings profile form to React Hook Form + Zod</name>
  <files>src/app/[locale]/(dashboard)/settings/page.tsx</files>
  <action>
Read the full file first. The settings page has profile fields (fullName, phone, language) using manual useState with no validation at all.

**Add imports:**
```tsx
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { cn } from "@/lib/utils";
```

**Define Zod schema** at the top of the file:
```tsx
const profileSchema = z.object({
  fullName: z.string().min(2, "Name must be at least 2 characters").max(100, "Name must be under 100 characters"),
  phone: z.string().regex(/^[\d+\-\s()]*$/, "Invalid phone number format").optional().or(z.literal("")),
  language: z.enum(["en", "ar"]),
});
type ProfileFormData = z.infer<typeof profileSchema>;
```

**Replace manual form state** with React Hook Form:
- Remove `useState` for `fullName`, `phone`, `language` (keep `isSaving`, `reminderTime`)
- Add `useForm`:
  ```tsx
  const { register, handleSubmit, formState: { errors }, reset } = useForm<ProfileFormData>({
    resolver: zodResolver(profileSchema),
    mode: "onBlur",
    reValidateMode: "onBlur",
    defaultValues: {
      fullName: profile?.full_name || "",
      phone: profile?.phone || "",
      language: (profile?.language || "en") as "en" | "ar",
    },
  });
  ```
- Add `useEffect` to reset form when profile loads:
  ```tsx
  useEffect(() => {
    if (profile) {
      reset({
        fullName: profile.full_name || "",
        phone: profile.phone || "",
        language: (profile.language || "en") as "en" | "ar",
      });
    }
  }, [profile, reset]);
  ```

**Create onSubmit handler:**
```tsx
const onSubmit = async (data: ProfileFormData) => {
  if (!user) return;
  setIsSaving(true);
  const supabase = createClient();
  await supabase
    .from("profiles")
    .update({ full_name: data.fullName, phone: data.phone, language: data.language } as never)
    .eq("id", user.id);
  refetch();
  setIsSaving(false);
};
```

**Update form JSX:**
- Wrap the profile section inputs in a `<form onSubmit={handleSubmit(onSubmit)}>`
- **Full name input:** Replace `value={fullName} onChange={(e) => setFullName(e.target.value)}` with `{...register("fullName")}`
  - Add error border: `className={cn("w-full h-12 px-4 border-4 border-black ...", errors.fullName && "border-error-500")}`
  - Add `aria-invalid={errors.fullName ? "true" : "false"}`
  - Add error message below:
    ```tsx
    {errors.fullName && (
      <p className="mt-1 font-mono text-xs text-error-500" role="alert">
        {errors.fullName.message}
      </p>
    )}
    ```
- **Phone input:** Same pattern with `{...register("phone")}` and error display
- **Language select:** Replace `value={language} onChange={(e) => setLanguage(e.target.value)}` with `{...register("language")}`
- **Save button:** Change from `onClick` handler to `type="submit"`, remove the inline async handler

Keep notifications section, account section, and plan details section exactly as-is. Only the profile section gets the React Hook Form treatment.
  </action>
  <verify>`pnpm tsc --noEmit 2>&1 | head -20` to verify TypeScript compiles. Grep: `grep -n "useForm\|zodResolver\|errors\.\|aria-invalid\|border-error" src/app/[locale]/(dashboard)/settings/page.tsx`</verify>
  <done>Settings profile form uses React Hook Form + Zod with onBlur validation. Full name validates min 2 chars. Phone validates format. Language validates as enum. Inline error messages with ARIA attributes present.</done>
</task>

</tasks>

<verification>
- `pnpm tsc --noEmit` passes
- Tickets form: `useForm` with `zodResolver` and `mode: "onBlur"`
- Settings form: `useForm` with `zodResolver` and `mode: "onBlur"`
- Both forms show inline error messages with `text-error-500` and `role="alert"`
- Both forms have `aria-invalid` on inputs with errors
- No remaining manual validation patterns (no `if (!subject.trim()) return` style checks)
</verification>

<success_criteria>
Both forms validate on blur with inline error messages. Error styling is consistent (border-error-500, font-mono text-xs text-error-500). ARIA attributes ensure screen reader accessibility. Forms still submit correctly with validated data.
</success_criteria>

<output>
After completion, create `.planning/phases/06-ux-polish/06-04-SUMMARY.md`
</output>
